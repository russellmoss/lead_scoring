[
  {
    "name": "H1_2024",
    "train_start": "2024-02-01",
    "train_end": "2024-06-30",
    "test_start": "2024-07-01",
    "test_end": "2024-12-31",
    "query": "\n-- V3.1 Backtest: Train on 2024-02-01 to 2024-06-30, Test on 2024-07-01 to 2024-12-31\n\nWITH \n-- Wirehouse exclusion patterns\nexcluded_firms AS (\n    SELECT pattern FROM UNNEST([\n        '%MERRILL%', '%MORGAN STANLEY%', '%UBS%', '%WELLS FARGO%',\n        '%EDWARD JONES%', '%RAYMOND JAMES%', '%LPL FINANCIAL%',\n        '%NORTHWESTERN MUTUAL%', '%MASS MUTUAL%', '%MASSMUTUAL%',\n        '%NEW YORK LIFE%', '%NYLIFE%', '%PRUDENTIAL%', '%PRINCIPAL%',\n        '%LINCOLN FINANCIAL%', '%TRANSAMERICA%', '%ALLSTATE%',\n        '%STATE FARM%', '%FARM BUREAU%', '%BANK OF AMERICA%',\n        '%JP MORGAN%', '%JPMORGAN%', '%AMERIPRISE%', '%FIDELITY%',\n        '%SCHWAB%', '%CHARLES SCHWAB%', '%VANGUARD%',\n        '%FISHER INVESTMENTS%', '%CREATIVE PLANNING%', '%EDELMAN%',\n        '%FIRST COMMAND%', '%T. ROWE PRICE%'\n    ]) AS pattern\n),\n\n-- Test period leads with features\ntest_leads AS (\n    SELECT \n        l.Id as lead_id,\n        l.FirstName, l.LastName, l.Email, l.Phone,\n        l.Company, l.Title, l.Status, l.LeadSource,\n        l.FA_CRD__c as advisor_crd,\n        DATE(l.stage_entered_contacting__c) as contacted_date,\n        CASE WHEN l.Stage_Entered_Call_Scheduled__c IS NOT NULL THEN 1 ELSE 0 END as converted,\n        f.current_firm_tenure_months,\n        f.industry_tenure_months,\n        f.firm_rep_count_at_contact,\n        f.firm_net_change_12mo,\n        f.pit_moves_3yr,\n        \n        -- Derived flags (CORRECTED thresholds)\n        f.current_firm_tenure_months / 12.0 as tenure_years,\n        f.industry_tenure_months / 12.0 as experience_years,\n        UPPER(l.Company) as company_upper\n    FROM `savvy-gtm-analytics.SavvyGTMData.Lead` l\n    INNER JOIN `savvy-gtm-analytics.ml_features.lead_scoring_features_pit` f\n        ON l.Id = f.lead_id\n    WHERE l.stage_entered_contacting__c IS NOT NULL\n        AND l.FA_CRD__c IS NOT NULL\n        AND l.Company NOT LIKE '%Savvy%'\n        AND DATE(l.stage_entered_contacting__c) >= '2024-07-01'\n        AND DATE(l.stage_entered_contacting__c) <= '2024-12-31'\n        -- Only include leads that are mature enough (30+ days old)\n        AND DATE_DIFF(CURRENT_DATE(), DATE(l.stage_entered_contacting__c), DAY) >= 30\n),\n\n-- Add wirehouse flag\nleads_with_flags AS (\n    SELECT \n        tl.*,\n        CASE \n            WHEN EXISTS (\n                SELECT 1 FROM excluded_firms ef \n                WHERE tl.company_upper LIKE ef.pattern\n            ) THEN 1 ELSE 0 \n        END as is_wirehouse\n    FROM test_leads tl\n),\n\n-- Assign tiers (V3.1 CORRECTED definitions)\ntiered_test AS (\n    SELECT \n        *,\n        CASE \n            -- TIER 1: PRIME MOVERS (3.40x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years BETWEEN 5 AND 15\n                 AND firm_net_change_12mo != 0\n                 AND is_wirehouse = 0\n            THEN 'TIER_1_PRIME_MOVER'\n            \n            -- TIER 2: MODERATE BLEEDERS (2.77x actual lift)\n            WHEN firm_net_change_12mo BETWEEN -10 AND -1\n                 AND experience_years >= 5\n            THEN 'TIER_2_MODERATE_BLEEDER'\n            \n            -- TIER 3: EXPERIENCED MOVERS (2.65x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years >= 20\n            THEN 'TIER_3_EXPERIENCED_MOVER'\n            \n            -- TIER 4: HEAVY BLEEDERS (2.28x actual lift)\n            WHEN firm_net_change_12mo < -10\n                 AND experience_years >= 5\n            THEN 'TIER_4_HEAVY_BLEEDER'\n            \n            -- STANDARD: Everything else\n            ELSE 'STANDARD'\n        END as score_tier\n    FROM leads_with_flags\n)\n\n-- Calculate tier performance\nSELECT \n    score_tier,\n    COUNT(*) as n_leads,\n    SUM(converted) as n_converted,\n    ROUND(AVG(converted) * 100, 2) as conversion_rate_pct,\n    ROUND(AVG(converted) / (\n        SELECT AVG(converted) \n        FROM tiered_test\n    ), 2) as lift_vs_pool,\n    '2024-02-01' as train_start,\n    '2024-06-30' as train_end,\n    '2024-07-01' as test_start,\n    '2024-12-31' as test_end\nFROM tiered_test\nGROUP BY score_tier\nORDER BY \n    CASE score_tier\n        WHEN 'TIER_1_PRIME_MOVER' THEN 1\n        WHEN 'TIER_2_MODERATE_BLEEDER' THEN 2\n        WHEN 'TIER_3_EXPERIENCED_MOVER' THEN 3\n        WHEN 'TIER_4_HEAVY_BLEEDER' THEN 4\n        ELSE 99\n    END\n",
    "query_file": "C:\\Users\\russe\\Documents\\Lead Scoring\\Version-3\\sql\\backtest_H1_2024.sql"
  },
  {
    "name": "Q1Q2_2024",
    "train_start": "2024-02-01",
    "train_end": "2024-05-31",
    "test_start": "2024-06-01",
    "test_end": "2024-08-31",
    "query": "\n-- V3.1 Backtest: Train on 2024-02-01 to 2024-05-31, Test on 2024-06-01 to 2024-08-31\n\nWITH \n-- Wirehouse exclusion patterns\nexcluded_firms AS (\n    SELECT pattern FROM UNNEST([\n        '%MERRILL%', '%MORGAN STANLEY%', '%UBS%', '%WELLS FARGO%',\n        '%EDWARD JONES%', '%RAYMOND JAMES%', '%LPL FINANCIAL%',\n        '%NORTHWESTERN MUTUAL%', '%MASS MUTUAL%', '%MASSMUTUAL%',\n        '%NEW YORK LIFE%', '%NYLIFE%', '%PRUDENTIAL%', '%PRINCIPAL%',\n        '%LINCOLN FINANCIAL%', '%TRANSAMERICA%', '%ALLSTATE%',\n        '%STATE FARM%', '%FARM BUREAU%', '%BANK OF AMERICA%',\n        '%JP MORGAN%', '%JPMORGAN%', '%AMERIPRISE%', '%FIDELITY%',\n        '%SCHWAB%', '%CHARLES SCHWAB%', '%VANGUARD%',\n        '%FISHER INVESTMENTS%', '%CREATIVE PLANNING%', '%EDELMAN%',\n        '%FIRST COMMAND%', '%T. ROWE PRICE%'\n    ]) AS pattern\n),\n\n-- Test period leads with features\ntest_leads AS (\n    SELECT \n        l.Id as lead_id,\n        l.FirstName, l.LastName, l.Email, l.Phone,\n        l.Company, l.Title, l.Status, l.LeadSource,\n        l.FA_CRD__c as advisor_crd,\n        DATE(l.stage_entered_contacting__c) as contacted_date,\n        CASE WHEN l.Stage_Entered_Call_Scheduled__c IS NOT NULL THEN 1 ELSE 0 END as converted,\n        f.current_firm_tenure_months,\n        f.industry_tenure_months,\n        f.firm_rep_count_at_contact,\n        f.firm_net_change_12mo,\n        f.pit_moves_3yr,\n        \n        -- Derived flags (CORRECTED thresholds)\n        f.current_firm_tenure_months / 12.0 as tenure_years,\n        f.industry_tenure_months / 12.0 as experience_years,\n        UPPER(l.Company) as company_upper\n    FROM `savvy-gtm-analytics.SavvyGTMData.Lead` l\n    INNER JOIN `savvy-gtm-analytics.ml_features.lead_scoring_features_pit` f\n        ON l.Id = f.lead_id\n    WHERE l.stage_entered_contacting__c IS NOT NULL\n        AND l.FA_CRD__c IS NOT NULL\n        AND l.Company NOT LIKE '%Savvy%'\n        AND DATE(l.stage_entered_contacting__c) >= '2024-06-01'\n        AND DATE(l.stage_entered_contacting__c) <= '2024-08-31'\n        -- Only include leads that are mature enough (30+ days old)\n        AND DATE_DIFF(CURRENT_DATE(), DATE(l.stage_entered_contacting__c), DAY) >= 30\n),\n\n-- Add wirehouse flag\nleads_with_flags AS (\n    SELECT \n        tl.*,\n        CASE \n            WHEN EXISTS (\n                SELECT 1 FROM excluded_firms ef \n                WHERE tl.company_upper LIKE ef.pattern\n            ) THEN 1 ELSE 0 \n        END as is_wirehouse\n    FROM test_leads tl\n),\n\n-- Assign tiers (V3.1 CORRECTED definitions)\ntiered_test AS (\n    SELECT \n        *,\n        CASE \n            -- TIER 1: PRIME MOVERS (3.40x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years BETWEEN 5 AND 15\n                 AND firm_net_change_12mo != 0\n                 AND is_wirehouse = 0\n            THEN 'TIER_1_PRIME_MOVER'\n            \n            -- TIER 2: MODERATE BLEEDERS (2.77x actual lift)\n            WHEN firm_net_change_12mo BETWEEN -10 AND -1\n                 AND experience_years >= 5\n            THEN 'TIER_2_MODERATE_BLEEDER'\n            \n            -- TIER 3: EXPERIENCED MOVERS (2.65x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years >= 20\n            THEN 'TIER_3_EXPERIENCED_MOVER'\n            \n            -- TIER 4: HEAVY BLEEDERS (2.28x actual lift)\n            WHEN firm_net_change_12mo < -10\n                 AND experience_years >= 5\n            THEN 'TIER_4_HEAVY_BLEEDER'\n            \n            -- STANDARD: Everything else\n            ELSE 'STANDARD'\n        END as score_tier\n    FROM leads_with_flags\n)\n\n-- Calculate tier performance\nSELECT \n    score_tier,\n    COUNT(*) as n_leads,\n    SUM(converted) as n_converted,\n    ROUND(AVG(converted) * 100, 2) as conversion_rate_pct,\n    ROUND(AVG(converted) / (\n        SELECT AVG(converted) \n        FROM tiered_test\n    ), 2) as lift_vs_pool,\n    '2024-02-01' as train_start,\n    '2024-05-31' as train_end,\n    '2024-06-01' as test_start,\n    '2024-08-31' as test_end\nFROM tiered_test\nGROUP BY score_tier\nORDER BY \n    CASE score_tier\n        WHEN 'TIER_1_PRIME_MOVER' THEN 1\n        WHEN 'TIER_2_MODERATE_BLEEDER' THEN 2\n        WHEN 'TIER_3_EXPERIENCED_MOVER' THEN 3\n        WHEN 'TIER_4_HEAVY_BLEEDER' THEN 4\n        ELSE 99\n    END\n",
    "query_file": "C:\\Users\\russe\\Documents\\Lead Scoring\\Version-3\\sql\\backtest_Q1Q2_2024.sql"
  },
  {
    "name": "Q2Q3_2024",
    "train_start": "2024-02-01",
    "train_end": "2024-08-31",
    "test_start": "2024-09-01",
    "test_end": "2024-11-30",
    "query": "\n-- V3.1 Backtest: Train on 2024-02-01 to 2024-08-31, Test on 2024-09-01 to 2024-11-30\n\nWITH \n-- Wirehouse exclusion patterns\nexcluded_firms AS (\n    SELECT pattern FROM UNNEST([\n        '%MERRILL%', '%MORGAN STANLEY%', '%UBS%', '%WELLS FARGO%',\n        '%EDWARD JONES%', '%RAYMOND JAMES%', '%LPL FINANCIAL%',\n        '%NORTHWESTERN MUTUAL%', '%MASS MUTUAL%', '%MASSMUTUAL%',\n        '%NEW YORK LIFE%', '%NYLIFE%', '%PRUDENTIAL%', '%PRINCIPAL%',\n        '%LINCOLN FINANCIAL%', '%TRANSAMERICA%', '%ALLSTATE%',\n        '%STATE FARM%', '%FARM BUREAU%', '%BANK OF AMERICA%',\n        '%JP MORGAN%', '%JPMORGAN%', '%AMERIPRISE%', '%FIDELITY%',\n        '%SCHWAB%', '%CHARLES SCHWAB%', '%VANGUARD%',\n        '%FISHER INVESTMENTS%', '%CREATIVE PLANNING%', '%EDELMAN%',\n        '%FIRST COMMAND%', '%T. ROWE PRICE%'\n    ]) AS pattern\n),\n\n-- Test period leads with features\ntest_leads AS (\n    SELECT \n        l.Id as lead_id,\n        l.FirstName, l.LastName, l.Email, l.Phone,\n        l.Company, l.Title, l.Status, l.LeadSource,\n        l.FA_CRD__c as advisor_crd,\n        DATE(l.stage_entered_contacting__c) as contacted_date,\n        CASE WHEN l.Stage_Entered_Call_Scheduled__c IS NOT NULL THEN 1 ELSE 0 END as converted,\n        f.current_firm_tenure_months,\n        f.industry_tenure_months,\n        f.firm_rep_count_at_contact,\n        f.firm_net_change_12mo,\n        f.pit_moves_3yr,\n        \n        -- Derived flags (CORRECTED thresholds)\n        f.current_firm_tenure_months / 12.0 as tenure_years,\n        f.industry_tenure_months / 12.0 as experience_years,\n        UPPER(l.Company) as company_upper\n    FROM `savvy-gtm-analytics.SavvyGTMData.Lead` l\n    INNER JOIN `savvy-gtm-analytics.ml_features.lead_scoring_features_pit` f\n        ON l.Id = f.lead_id\n    WHERE l.stage_entered_contacting__c IS NOT NULL\n        AND l.FA_CRD__c IS NOT NULL\n        AND l.Company NOT LIKE '%Savvy%'\n        AND DATE(l.stage_entered_contacting__c) >= '2024-09-01'\n        AND DATE(l.stage_entered_contacting__c) <= '2024-11-30'\n        -- Only include leads that are mature enough (30+ days old)\n        AND DATE_DIFF(CURRENT_DATE(), DATE(l.stage_entered_contacting__c), DAY) >= 30\n),\n\n-- Add wirehouse flag\nleads_with_flags AS (\n    SELECT \n        tl.*,\n        CASE \n            WHEN EXISTS (\n                SELECT 1 FROM excluded_firms ef \n                WHERE tl.company_upper LIKE ef.pattern\n            ) THEN 1 ELSE 0 \n        END as is_wirehouse\n    FROM test_leads tl\n),\n\n-- Assign tiers (V3.1 CORRECTED definitions)\ntiered_test AS (\n    SELECT \n        *,\n        CASE \n            -- TIER 1: PRIME MOVERS (3.40x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years BETWEEN 5 AND 15\n                 AND firm_net_change_12mo != 0\n                 AND is_wirehouse = 0\n            THEN 'TIER_1_PRIME_MOVER'\n            \n            -- TIER 2: MODERATE BLEEDERS (2.77x actual lift)\n            WHEN firm_net_change_12mo BETWEEN -10 AND -1\n                 AND experience_years >= 5\n            THEN 'TIER_2_MODERATE_BLEEDER'\n            \n            -- TIER 3: EXPERIENCED MOVERS (2.65x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years >= 20\n            THEN 'TIER_3_EXPERIENCED_MOVER'\n            \n            -- TIER 4: HEAVY BLEEDERS (2.28x actual lift)\n            WHEN firm_net_change_12mo < -10\n                 AND experience_years >= 5\n            THEN 'TIER_4_HEAVY_BLEEDER'\n            \n            -- STANDARD: Everything else\n            ELSE 'STANDARD'\n        END as score_tier\n    FROM leads_with_flags\n)\n\n-- Calculate tier performance\nSELECT \n    score_tier,\n    COUNT(*) as n_leads,\n    SUM(converted) as n_converted,\n    ROUND(AVG(converted) * 100, 2) as conversion_rate_pct,\n    ROUND(AVG(converted) / (\n        SELECT AVG(converted) \n        FROM tiered_test\n    ), 2) as lift_vs_pool,\n    '2024-02-01' as train_start,\n    '2024-08-31' as train_end,\n    '2024-09-01' as test_start,\n    '2024-11-30' as test_end\nFROM tiered_test\nGROUP BY score_tier\nORDER BY \n    CASE score_tier\n        WHEN 'TIER_1_PRIME_MOVER' THEN 1\n        WHEN 'TIER_2_MODERATE_BLEEDER' THEN 2\n        WHEN 'TIER_3_EXPERIENCED_MOVER' THEN 3\n        WHEN 'TIER_4_HEAVY_BLEEDER' THEN 4\n        ELSE 99\n    END\n",
    "query_file": "C:\\Users\\russe\\Documents\\Lead Scoring\\Version-3\\sql\\backtest_Q2Q3_2024.sql"
  },
  {
    "name": "Full_2024",
    "train_start": "2024-02-01",
    "train_end": "2024-10-31",
    "test_start": "2024-11-01",
    "test_end": "2025-01-31",
    "query": "\n-- V3.1 Backtest: Train on 2024-02-01 to 2024-10-31, Test on 2024-11-01 to 2025-01-31\n\nWITH \n-- Wirehouse exclusion patterns\nexcluded_firms AS (\n    SELECT pattern FROM UNNEST([\n        '%MERRILL%', '%MORGAN STANLEY%', '%UBS%', '%WELLS FARGO%',\n        '%EDWARD JONES%', '%RAYMOND JAMES%', '%LPL FINANCIAL%',\n        '%NORTHWESTERN MUTUAL%', '%MASS MUTUAL%', '%MASSMUTUAL%',\n        '%NEW YORK LIFE%', '%NYLIFE%', '%PRUDENTIAL%', '%PRINCIPAL%',\n        '%LINCOLN FINANCIAL%', '%TRANSAMERICA%', '%ALLSTATE%',\n        '%STATE FARM%', '%FARM BUREAU%', '%BANK OF AMERICA%',\n        '%JP MORGAN%', '%JPMORGAN%', '%AMERIPRISE%', '%FIDELITY%',\n        '%SCHWAB%', '%CHARLES SCHWAB%', '%VANGUARD%',\n        '%FISHER INVESTMENTS%', '%CREATIVE PLANNING%', '%EDELMAN%',\n        '%FIRST COMMAND%', '%T. ROWE PRICE%'\n    ]) AS pattern\n),\n\n-- Test period leads with features\ntest_leads AS (\n    SELECT \n        l.Id as lead_id,\n        l.FirstName, l.LastName, l.Email, l.Phone,\n        l.Company, l.Title, l.Status, l.LeadSource,\n        l.FA_CRD__c as advisor_crd,\n        DATE(l.stage_entered_contacting__c) as contacted_date,\n        CASE WHEN l.Stage_Entered_Call_Scheduled__c IS NOT NULL THEN 1 ELSE 0 END as converted,\n        f.current_firm_tenure_months,\n        f.industry_tenure_months,\n        f.firm_rep_count_at_contact,\n        f.firm_net_change_12mo,\n        f.pit_moves_3yr,\n        \n        -- Derived flags (CORRECTED thresholds)\n        f.current_firm_tenure_months / 12.0 as tenure_years,\n        f.industry_tenure_months / 12.0 as experience_years,\n        UPPER(l.Company) as company_upper\n    FROM `savvy-gtm-analytics.SavvyGTMData.Lead` l\n    INNER JOIN `savvy-gtm-analytics.ml_features.lead_scoring_features_pit` f\n        ON l.Id = f.lead_id\n    WHERE l.stage_entered_contacting__c IS NOT NULL\n        AND l.FA_CRD__c IS NOT NULL\n        AND l.Company NOT LIKE '%Savvy%'\n        AND DATE(l.stage_entered_contacting__c) >= '2024-11-01'\n        AND DATE(l.stage_entered_contacting__c) <= '2025-01-31'\n        -- Only include leads that are mature enough (30+ days old)\n        AND DATE_DIFF(CURRENT_DATE(), DATE(l.stage_entered_contacting__c), DAY) >= 30\n),\n\n-- Add wirehouse flag\nleads_with_flags AS (\n    SELECT \n        tl.*,\n        CASE \n            WHEN EXISTS (\n                SELECT 1 FROM excluded_firms ef \n                WHERE tl.company_upper LIKE ef.pattern\n            ) THEN 1 ELSE 0 \n        END as is_wirehouse\n    FROM test_leads tl\n),\n\n-- Assign tiers (V3.1 CORRECTED definitions)\ntiered_test AS (\n    SELECT \n        *,\n        CASE \n            -- TIER 1: PRIME MOVERS (3.40x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years BETWEEN 5 AND 15\n                 AND firm_net_change_12mo != 0\n                 AND is_wirehouse = 0\n            THEN 'TIER_1_PRIME_MOVER'\n            \n            -- TIER 2: MODERATE BLEEDERS (2.77x actual lift)\n            WHEN firm_net_change_12mo BETWEEN -10 AND -1\n                 AND experience_years >= 5\n            THEN 'TIER_2_MODERATE_BLEEDER'\n            \n            -- TIER 3: EXPERIENCED MOVERS (2.65x actual lift)\n            WHEN tenure_years BETWEEN 1 AND 4\n                 AND experience_years >= 20\n            THEN 'TIER_3_EXPERIENCED_MOVER'\n            \n            -- TIER 4: HEAVY BLEEDERS (2.28x actual lift)\n            WHEN firm_net_change_12mo < -10\n                 AND experience_years >= 5\n            THEN 'TIER_4_HEAVY_BLEEDER'\n            \n            -- STANDARD: Everything else\n            ELSE 'STANDARD'\n        END as score_tier\n    FROM leads_with_flags\n)\n\n-- Calculate tier performance\nSELECT \n    score_tier,\n    COUNT(*) as n_leads,\n    SUM(converted) as n_converted,\n    ROUND(AVG(converted) * 100, 2) as conversion_rate_pct,\n    ROUND(AVG(converted) / (\n        SELECT AVG(converted) \n        FROM tiered_test\n    ), 2) as lift_vs_pool,\n    '2024-02-01' as train_start,\n    '2024-10-31' as train_end,\n    '2024-11-01' as test_start,\n    '2025-01-31' as test_end\nFROM tiered_test\nGROUP BY score_tier\nORDER BY \n    CASE score_tier\n        WHEN 'TIER_1_PRIME_MOVER' THEN 1\n        WHEN 'TIER_2_MODERATE_BLEEDER' THEN 2\n        WHEN 'TIER_3_EXPERIENCED_MOVER' THEN 3\n        WHEN 'TIER_4_HEAVY_BLEEDER' THEN 4\n        ELSE 99\n    END\n",
    "query_file": "C:\\Users\\russe\\Documents\\Lead Scoring\\Version-3\\sql\\backtest_Full_2024.sql"
  }
]